{% extends "layout_dashboard.html" %}

{% block styles %}
<link rel="stylesheet" href="../static/css/monitoring.css">
{% endblock %}

{% block sidebar_monitoring %}
class="active"
{% endblock %}

{% block content %}
<h4 class="title title2">Monitoring</h4>
<div class="container">
  <div class="camera_container">
    <div class="camera_view">
      <!-- PLACEHOLDER (visible when no stream) -->
      <div id="placeholder" class="stream-placeholder">
        <div>
          <div style="font-size:1.6rem; margin-bottom:8px">Stream belum aktif</div>
          <div style="font-weight:400; font-size:0.9rem; color:#999;">Hubungkan perangkat kamera atau tekan "Mulai Livestream"</div>
        </div>
      </div>

      <!-- LOADING overlay -->
      <div id="loading" class="loading-overlay" style="display:none; opacity:0;">
        <div style="display:flex; gap:8px;">
          <div class="loading-dot"></div>
          <div class="loading-dot"></div>
          <div class="loading-dot"></div>
        </div>
        <div style="color:#fff; font-weight:600;">Mempersiapkan streamâ€¦</div>
      </div>

      <!-- Actual video area -->
      <canvas id="liveCanvas" style="display:none;"></canvas>
      <img id="liveImg" style="display:none;" alt="Live Stream" />
    </div>

    <div class="camera-controls">
      <button id="startBtn" class="btn-live">Mulai Livestream</button>
      <button id="stopBtn" class="btn-stop">Matikan Livestream</button>
    </div>
    <div class="stream-status" id="streamStatus">Status: <span id="streamState">Offline</span></div>
  </div>

  <div class="boxes">
    <div class="box box1">
       <span class="text">Ikan Terindikasi Mati</span>
       <span class="number" id="deadStatus">N/A</span>
       <div id="lastUpdated" style="font-size:0.8rem; font-weight:300; margin-top:4px;">
          Last Updated: -
       </div>
    </div>
    <div class="box box2">
       <span class="text">Ikan Terindikasi Sakit</span>
       <span class="number" id="sickCount">N/A</span>
       <div id="lastUpdatedSick" style="font-size:0.8rem; font-weight:300; margin-top:4px;">
          Last Updated: -
       </div>
    </div>
  </div>

  <!-- analisis kematian ikan disini -->
  <div class="container_analisis">
    <span class="title3">Analisis Kematian Oleh AI</span>
    <div class="box_analisis_ai">
      <div id="aiOutput" style="word-wrap:break-word; text-align:justify; display:flex; flex-direction: column; gap: 0; font-size: 1.1rem; line-height: 1.2;">{{ analysis|safe }}</div>
    </div>
    <span style="font-weight: 300;">Respons AI dapat mengandung kekeliruan. Mohon diperiksa ulang</span>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="../static/js/monitoring.js"></script>
{% endblock %}
